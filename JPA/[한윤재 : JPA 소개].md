# JPA

>JPA - Java Persistence Api;  자바 표준 ORM 기술

>ORM - Object Relational Mapping. 자바 객체와 RDB 테이블 매핑

Object는 자바의 객체를 , Relational Database는 관계형 데이터베이스의 Relational 을 , Mapping은 연결짓기를 뜻한다.

## 소개
>jpa는 자바가 표준으로 채택한 객체 - 테이블(DB) 매핑 기술이다.  

자바는 데이터를 객체에 저장한다. 반면 관계형 데이터베이스는 테이블에 데이터를 저장한다. 이 둘은 비슷하지만 몇 가지 특징의 차이로 상당한 간극이 벌어진다. 

자바는 JDBC를 통해 데이터베이스와 소통한다. 그러나 이 api는 사용법이 매우 까다롭다. 따라서 JDBC의 사용을 쉽게 만들어주는 MyBatis나 JDBCTemplate같은 프로그램들이 존재한다.  

JPA도 JDBC를 사용하기 편하게 만들어주지만 이는 JPA의 본질적인 특성은 아니다.

>JPA는 객체와 관계형 데이터베이스간의 차이를 메우기 위해 등장했다.

이 거창함은 무엇인가? 무슨 차이를 메우기 위해 등장했는지 이제부터 자세히 알아보자.  

### 테이블과 객체는 달라
자바에서 정보는 객체에 담겨있고 이를 데이터베이스 테이블에 옮겨담기 위해 객체와 유사한 정의를 갖는 테이블을 만든다.  

#### 차이점
1. 타입
2. 상속
3. 연관관계 조회
4. 객체 그래프 탐색

##### 타입의 불일치
자바의 타입과 DB에 저장되는 타입이 같지 않다. String 하나만 하더라도 DB에서는 VARCHAR, CHAR, VARCHAR2, LONGTEXT, TEXT 등 다양한 형태로 제공된다.  

자바의 enum 열거형 타입같은 경우는 DB에  담을만한 마땅한 타입도 없다.  
외에도 많은 타입들이 서로 일치하지 않아서 이를 적절히(?) 유사한 타입으로 저장해야하는 불일치가 존재한다.  

##### 상속관계
객체에는 상속관계가 존재한다. 상속관계에 있는 부모자식 객체를 어떻게 DB에 저장하고 불러올 수 있을까?  
DB에는 슈퍼타입 서브타입으로 일종의 상속관계를 정의하는 방법이 존재한다. 이를 이용해서 객체의 상속관계를 유사하게 저장하는 방법은 있다.  

##### 연관관계 조회
가장 중요한 차이중 하나인 연관관계에 대해 알아보자.

객체는 포함관계(Composit)를 통해 다른 객체를 필드로 갖는다. 이때 필드로 갖고있는 객체는 해당 객체 자체라고 볼 수 있다. 이를 통해 직접적으로 타 객체의 데이터에 접근하는 것이 가능하다.  

테이블은 외래키를 통해 연관관계를 맺는다. 해당 키를 통해 다른 테이블에 존재하는 객체를 조회할 수 있고 join을 통해 해당 객체의 데이터를 함께 조회할 수 있다.  
큰차이는 테이블은 fk 를 통한 타 객체의 참조가 양방향으로 일어날 수 있다는 점이다.  
객체는 자신이 갖고있는 타 객체의 참조를 통해 해당 객체에 직접 접근하지만, 접근 당하는 입장의 객체는 자신을 참조하고있는 객체로 접근할 수 없다. 단방향 조회만이 가능한 것이다.  

그러나 테이블은 외래키(fk)가 곧 참조당하는 엔티티의 pk이며. pk는 마찬가지로 자신을 참조하는 엔티티의 외래키이다. 서로의 참조를 함께 공유하는 셈이다. 

사정이 이렇다 보니 DB에 맞춰 객체를 설계하면 객체가 FK를 필드로 가져야하며, 반대로 객체지향적으로 연관된 객체를 갖도록 설계하자니 쿼리가 매우 복잡해지는 것이다.

##### 객체의 그래프 탐색
앞선 논의에서 객체지향적으로 연관관계를 맺도록 쿼리를 설계했다고 가정해보자.  
객체가 FK를 필드로 갖는 대신 연관관계의 객체를 필드로 갖는다. 그런데 문제는 포함관계에 있는 객체가 또 다른 객체를 포함할 수 있다는 것이다.  

그러면 쿼리를 통해 객체안의 객체안의 객체를 어디까지 조회해서 연관관계를 설정해놓아야 하는 것일까 하는 문제에 봉착한다.  

잘 사용되지 않을 객체안의 객체안의 객체를 미리 조회해서 저장해놓는 것은 여러모로 낭비고 비용이 크다.  

##### 정리
테이블과 객체를 맞출 수 없는것이 아니라 맞추는데에 너무 많은 비용이 드는것이 문제. 이런 과정을 늘 반복하려면 정말 힘든일이었을 것이다.  

JPA는 이런 불일치 문제를 상당부분 해결하고, 객체를 마치 List, Set, Map 같은 컬렉션 프레임워크에 저장하듯이 DB에 객체를 담을 수 있게 기능을 제공한다.  

### 추상화된 DB
JPA는 단순히 쿼리를 작성하지 않기 위해 존재하는 기술이 아니다. 그보다는 오히려 어플리케이션 레벨에서 추상화된 데이터베이스를 제공하는 것에 의미가 있는 것으로 보인다.  

#### JPA는 특정 DB 제품에 종속되지 않는 기술을 제공한다.

DB는 DB 제품들 마저도 서로 같은 타입에 대해 이름이 다르거나. 쿼리 문법이 조금씩 차이가 있는 등 미묘하게 표준화 되어있지 않다.  

이런 많은 DB 제품군을 JPA는 동일한 방식으로 자바 어플리케이션과 소통할 수 있도록 중간에서 다리를 놓아준다.  

#### JPQL
JPA만의 독특한 객체지향 쿼리 문법인 JPQL을 제공한다. 물론 개발자 입장에서 새로운 형태의 쿼리를 또 배우는 것도 비용이지만 대체로 일반적인 SQL문법과 유사한 문법을 제공한다.  
해당 쿼리 문법도 마찬가지로 모든 DB로부터 독립적이다. JPQL을 배우면 모든 DB에 공통으로 적용되는 쿼리를 배우는 것과 같다.  



